<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphing Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl bg-white rounded-lg shadow-lg p-6 md:p-8">
        <header class="text-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Graphing Calculator</h1>
            <p class="text-gray-600 mt-2">Define your window, enter one or more equations, and see them graphed!</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Controls -->
            <div class="md:col-span-1 space-y-6">
                <div>
                    <h2 class="text-lg font-semibold text-gray-700 mb-3">Viewing Window</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="x-min" class="block text-sm font-medium text-gray-600">X Min</label>
                            <input type="number" id="x-min" value="-10" class="mt-1 w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="x-max" class="block text-sm font-medium text-gray-600">X Max</label>
                            <input type="number" id="x-max" value="10" class="mt-1 w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="y-min" class="block text-sm font-medium text-gray-600">Y Min</label>
                            <input type="number" id="y-min" value="-10" class="mt-1 w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="y-max" class="block text-sm font-medium text-gray-600">Y Max</label>
                            <input type="number" id="y-max" value="10" class="mt-1 w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
                <div>
                    <h2 class="text-lg font-semibold text-gray-700 mb-3">Equations</h2>
                    <div id="equation-list" class="space-y-2">
                        <!-- Equation inputs will be added here dynamically -->
                    </div>
                    <button id="add-equation-btn" class="mt-2 w-full flex items-center justify-center py-2 px-4 border border-dashed border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                        </svg>
                        Add Equation
                    </button>
                </div>
                <button id="graph-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition shadow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Graph
                </button>
                 <div id="error-message" class="hidden text-red-600 font-medium text-center p-3 bg-red-100 rounded-lg"></div>
            </div>

            <!-- Graph Canvas -->
            <div class="md:col-span-2 bg-gray-50 p-2 rounded-lg border border-gray-200 aspect-square">
                 <canvas id="graph-canvas"></canvas>
            </div>
        </main>
    </div>

    <script>
        const canvas = document.getElementById('graph-canvas');
        const ctx = canvas.getContext('2d');
        const graphBtn = document.getElementById('graph-btn');
        const errorMessage = document.getElementById('error-message');
        const equationList = document.getElementById('equation-list');
        const addEquationBtn = document.getElementById('add-equation-btn');

        const xMinInput = document.getElementById('x-min');
        const xMaxInput = document.getElementById('x-max');
        const yMinInput = document.getElementById('y-min');
        const yMaxInput = document.getElementById('y-max');
        
        let DPI = window.devicePixelRatio || 1;
        let plotFunctions = [];
        const plotColors = ['#2563eb', '#db2777', '#16a34a', '#f97316', '#9333ea', '#0891b2']; // blue, pink, green, orange, purple, cyan

        function resizeCanvas() {
            const container = canvas.parentElement;
            const size = Math.min(container.clientWidth, container.clientHeight);
            canvas.width = size * DPI;
            canvas.height = size * DPI;
            canvas.style.width = `${size}px`;
            canvas.style.height = `${size}px`;
            ctx.scale(DPI, DPI);
        }

        // Parse and create a function from the equation string
        function parseEquation(str) {
            if (!str) return null;
            try {
                // Sanitize and prepare string for Function constructor
                let funcStr = str.trim().toLowerCase();
                
                // Replace y=
                if (funcStr.startsWith('y=')) {
                    funcStr = funcStr.substring(2);
                }

                // Replace ^ with ** for exponentiation
                funcStr = funcStr.replace(/\^/g, '**');

                // Add Math. prefix to supported functions
                const mathFuncs = ['sin', 'cos', 'tan', 'sqrt', 'abs', 'log', 'exp', 'pow', 'ceil', 'floor'];
                mathFuncs.forEach(f => {
                    const regex = new RegExp(`\\b${f}\\(`, 'g');
                    funcStr = funcStr.replace(regex, `Math.${f}(`);
                });
                
                // Add support for pi and e
                funcStr = funcStr.replace(/\bpi\b/g, 'Math.PI');
                funcStr = funcStr.replace(/\be\b/g, 'Math.E');

                // If the processed string is empty, it's invalid.
                if (!funcStr) return null;

                return new Function('x', `return ${funcStr}`);
            } catch (e) {
                console.error("Parsing error:", e);
                return null;
            }
        }

        function drawGraph() {
            resizeCanvas();
            const width = canvas.width / DPI;
            const height = canvas.height / DPI;
            ctx.clearRect(0, 0, width, height);

            const xMin = parseFloat(xMinInput.value);
            const xMax = parseFloat(xMaxInput.value);
            const yMin = parseFloat(yMinInput.value);
            const yMax = parseFloat(yMaxInput.value);

            // Basic validation
            if (isNaN(xMin) || isNaN(xMax) || isNaN(yMin) || isNaN(yMax) || xMin >= xMax || yMin >= yMax) {
                showError("Invalid window settings. Min must be less than Max.");
                return;
            }
            hideError();

            const xRange = xMax - xMin;
            const yRange = yMax - yMin;

            // Coordinate transformation functions
            const toPixelX = (x) => ((x - xMin) / xRange) * width;
            const toPixelY = (y) => height - ((y - yMin) / yRange) * height;

            // Draw grid and axes
            drawGridAndAxes(xMin, xMax, yMin, yMax, toPixelX, toPixelY);

            // Plot the equations if they exist
            if (plotFunctions.length > 0) {
                 plotFunctions.forEach((plot) => {
                    const { func, color } = plot;
                    if (!func) return;

                    ctx.beginPath();
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    
                    let firstPoint = true;

                    for (let px = 0; px <= width; px++) {
                        const x = xMin + (px / width) * xRange;
                        const y = func(x);

                        if (isFinite(y)) {
                            const py = toPixelY(y);
                            if (firstPoint) {
                                ctx.moveTo(px, py);
                                firstPoint = false;
                            } else {
                                ctx.lineTo(px, py);
                            }
                        } else {
                            // Handle discontinuities (like in tan(x) or 1/x)
                            firstPoint = true; 
                        }
                    }
                    ctx.stroke();
                });
            }
        }
        
        function drawGridAndAxes(xMin, xMax, yMin, yMax, toPixelX, toPixelY) {
            const width = canvas.width / DPI;
            const height = canvas.height / DPI;
            
            ctx.strokeStyle = '#d1d5db'; // gray-300
            ctx.fillStyle = '#6b7280'; // gray-500
            ctx.font = '10px Inter';
            ctx.lineWidth = 1;
            
            // Set the step for grid lines to 1
            const xStep = 1;
            const yStep = 1;

            // Vertical grid lines and labels
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            for (let x = Math.ceil(xMin / xStep) * xStep; x < xMax; x += xStep) {
                const px = toPixelX(x);
                ctx.beginPath();
                ctx.moveTo(px, 0);
                ctx.lineTo(px, height);
                ctx.stroke();
                if (Math.abs(x) > 1e-9) ctx.fillText(x, px, toPixelY(0) + 4);
            }
            
            // Horizontal grid lines and labels
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let y = Math.ceil(yMin / yStep) * yStep; y < yMax; y += yStep) {
                const py = toPixelY(y);
                ctx.beginPath();
                ctx.moveTo(0, py);
                ctx.lineTo(width, py);
                ctx.stroke();
                if (Math.abs(y) > 1e-9) ctx.fillText(y, toPixelX(0) - 4, py);
            }

            // Draw main axes
            ctx.strokeStyle = '#374151'; // gray-700
            ctx.lineWidth = 1.5;
            
            // Y-Axis
            ctx.beginPath();
            ctx.moveTo(toPixelX(0), 0);
            ctx.lineTo(toPixelX(0), height);
            ctx.stroke();
            
            // X-Axis
            ctx.beginPath();
            ctx.moveTo(0, toPixelY(0));
            ctx.lineTo(width, toPixelY(0));
            ctx.stroke();
            
            // Origin label
            ctx.fillText('0', toPixelX(0) - 4, toPixelY(0) + 12);
        }

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        function handleGraphClick() {
            plotFunctions = [];
            const inputs = document.querySelectorAll('.equation-input');
            let allValid = true;

            inputs.forEach((input, index) => {
                const equationStr = input.value;
                if (equationStr) { // Only process non-empty inputs
                    const func = parseEquation(equationStr);
                    if (!func) {
                        allValid = false;
                        input.classList.add('border-red-500', 'ring-red-500');
                    } else {
                        input.classList.remove('border-red-500', 'ring-red-500');
                    }
                    plotFunctions.push({
                        func: func,
                        color: plotColors[index % plotColors.length]
                    });
                }
            });

            if (!allValid) {
                showError("Could not parse one or more equations. Check syntax.");
            } else {
                 hideError();
            }
            drawGraph();
        }

        function addEquationInput(initialValue = '') {
            const container = document.createElement('div');
            container.className = 'flex items-center space-x-2';

            const colorDot = document.createElement('span');
            const colorIndex = equationList.children.length % plotColors.length;
            colorDot.className = 'w-3 h-3 rounded-full';
            colorDot.style.backgroundColor = plotColors[colorIndex];
            
            const label = document.createElement('label');
            label.className = 'text-sm font-medium text-gray-600';
            label.textContent = 'y =';

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'equation-input flex-grow p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500';
            input.placeholder = `e.g., sin(x)`;
            input.value = initialValue;
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'p-1 text-gray-400 hover:text-red-600 hover:bg-red-100 rounded-full focus:outline-none focus:ring-2 focus:ring-red-500';
            removeBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>`;
            removeBtn.onclick = () => {
                container.remove();
            };

            container.appendChild(colorDot);
            container.appendChild(label);
            container.appendChild(input);
            container.appendChild(removeBtn);
            equationList.appendChild(container);

            input.focus();
        }


        // Event Listeners
        graphBtn.addEventListener('click', handleGraphClick);
        addEquationBtn.addEventListener('click', () => addEquationInput());

        document.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                 if (event.target.classList.contains('equation-input') || ['x-min', 'x-max', 'y-min', 'y-max'].includes(event.target.id)) {
                    handleGraphClick();
                }
            }
        });
        
        window.addEventListener('resize', drawGraph);
        
        // Initial setup
        resizeCanvas();
        addEquationInput('x^2'); // Start with one equation
        drawGraph();

    </script>
</body>
</html>

