<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher's Toolkit</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #f4f7f9;
            --card-background: white;
            --text-color: #333;
            --border-color: #dfe6e9;
            --success-color: #27ae60;
            --danger-color: #c0392b;
            --warning-color: #f39c12;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }
        /* --- Main Menu --- */
        #main-menu {
            padding: 30px;
            background-color: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            max-width: 900px;
            margin: 20px auto;
        }
        #main-menu h1 { text-align: center; color: var(--secondary-color); }
        .roster-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 25px;
            margin-bottom: 25px;
        }
        #studentNames { grid-column: 1 / -1; min-height: 150px; }
        .tool-selection { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .tool-btn {
            background: var(--primary-color);
            color: white; border: none; border-radius: 12px; padding: 20px 30px;
            font-size: 1.2em; font-weight: bold; cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .tool-btn:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        /* --- General Tool Styles --- */
        .tool { display: none; }
        .tool-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #eee; max-width: 1200px; margin-left: auto; margin-right: auto;}
        .back-to-menu-btn { background-color: #7f8c8d; color: white; padding: 10px 20px; cursor: pointer; font-weight: bold; border:none; border-radius: 8px;}
        .container { max-width: 1200px; margin: auto; }
        .panel, .card { background: var(--card-background); padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #5f6368; }
        textarea, select, input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { cursor: pointer; border-radius: 8px; border: none; font-weight: bold; color: white; padding: 12px 15px; transition: background-color .2s ease; }
        
        /* --- Games Hub Specific Styles --- */
        #games-hub .container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        #dice-roller, #spinner { text-align: center; }
        #dice-display { font-size: 5rem; height: 100px; display: flex; justify-content: center; align-items: center; }
        #spinner-container { position: relative; width: 350px; height: 350px; margin: 10px auto; }
        #spinner-canvas { transition: transform 4s cubic-bezier(0.25, 1, 0.5, 1); }
        #spinner-arrow {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 30px solid var(--danger-color);
        }
        #spinner-result {
            margin-top: 15px; font-size: 1.5em; font-weight: bold; color: var(--secondary-color); height: 2em;
        }

        /* Other tool styles from previous versions */
        #timer-tool .encouraging-banner { background: linear-gradient(45deg, #1abc9c, #16a085); color: white; text-align: center; padding: 25px; border-radius: 12px; font-size: 1.5em; font-weight: bold; margin-bottom: 20px; }
        #timer-display { font-size: 8rem; font-weight: bold; text-align: center; color: var(--secondary-color); margin: 20px 0; }
        #gr-results { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
        .group-card { background-color: #e8f0fe; border: 1px solid #d2e3fc; padding: 15px; border-radius: 8px; }
        #sc-seating-chart { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; }
        .seat { border: 2px solid var(--border-color); border-radius: 12px; padding: 10px; text-align: center; aspect-ratio: 1.5 / 1; display: flex; flex-direction: column; justify-content: space-between; }
        .seat.occupied { background-color: #e9f3fb; border-color: #a9cce3; }
        #student-picker-tool .container { display: flex; gap: 30px; align-items: stretch; }
        #student-picker-tool .picker-panel { flex: 1.5; text-align: center; display: flex; flex-direction: column; justify-content: center;}
    </style>
</head>
<body>

    <div id="main-menu">
        <h1>Teacher's Toolkit 🧰</h1>
        <div class="roster-management">
            <textarea id="studentNames" placeholder="Paste student names here (for roster tools)..."></textarea>
            <select id="rosterSelect"></select>
            <input type="text" id="rosterName" placeholder="Roster Name (for saving)">
            <button id="save-btn" style="background-color: var(--success-color);">Save Roster</button>
            <button id="delete-btn" style="background-color: var(--danger-color);">Delete Selected</button>
        </div>
        <h2>Choose a Tool:</h2>
        <div class="tool-selection">
            <button class="tool-btn" onclick="activateTool('group-randomizer-tool')">Group Randomizer</button>
            <button class="tool-btn" onclick="activateTool('seating-chart-tool')">Seating Chart</button>
            <button class="tool-btn" onclick="activateTool('student-picker-tool')">Student Picker</button>
            <button class="tool-btn" onclick="activateTool('timer-tool')" style="background-color: #8e44ad;">Timer</button>
            <button class="tool-btn" onclick="activateTool('notes-tool')" style="background-color: #2c3e50;">Notes</button>
            <button class="tool-btn" onclick="activateTool('games-hub')" style="background-color: #f39c12;">Games & Activities 🎲</button>
        </div>
    </div>

    <div id="group-randomizer-tool" class="tool"></div>
    <div id="seating-chart-tool" class="tool"></div>
    <div id="student-picker-tool" class="tool"></div>
    <div id="timer-tool" class="tool"></div>
    <div id="notes-tool" class="tool"></div>
    <div id="games-hub" class="tool"></div>

    <script>
    // ======================= GLOBAL STATE & NAVIGATION =======================
    const studentNamesEl = document.getElementById('studentNames'); let currentStudents = [];
    const rosterNameEl = document.getElementById('rosterName'); const rosterSelectEl = document.getElementById('rosterSelect');
    
    function showView(viewId) {
        document.getElementById('main-menu').style.display = 'none';
        document.querySelectorAll('.tool').forEach(tool => tool.style.display = 'none');
        document.getElementById(viewId).style.display = 'block';
    }

    function activateTool(toolId) {
        const rosterTools = ['group-randomizer-tool', 'seating-chart-tool', 'student-picker-tool'];
        if (rosterTools.includes(toolId)) {
            currentStudents = studentNamesEl.value.trim().split('\n').filter(name => name.trim() !== '');
            if (currentStudents.length === 0) {
                alert("Please enter some student names first for this tool!");
                return;
            }
        }
        
        if (toolId === 'group-randomizer-tool') setupGroupRandomizer();
        if (toolId === 'seating-chart-tool') setupSeatingChart();
        if (toolId === 'student-picker-tool') setupStudentPicker();
        if (toolId === 'timer-tool') setupTimer();
        if (toolId === 'notes-tool') setupNotes();
        if (toolId === 'games-hub') setupGamesHub();
        
        showView(toolId);
    }
    
    function getRosters() { return JSON.parse(localStorage.getItem('teacherToolkitRosters')) || {}; }
    function saveRosters(rosters) { localStorage.setItem('teacherToolkitRosters', JSON.stringify(rosters)); }

    // ======================= INITIALIZATION =======================
    // **FIX:** All event listeners are now wrapped in DOMContentLoaded to ensure the page is loaded first.
    document.addEventListener('DOMContentLoaded', () => {
        const loadRosterList = () => {
            const rosters = getRosters();
            rosterSelectEl.innerHTML = '<option value="">-- Load a Saved Roster --</option>';
            for (const name in rosters) rosterSelectEl.innerHTML += `<option value="${name}">${name}</option>`;
        };

        rosterSelectEl.addEventListener('change', () => {
            const selectedName = rosterSelectEl.value;
            if (selectedName) { studentNamesEl.value = getRosters()[selectedName]; rosterNameEl.value = selectedName; }
        });

        document.getElementById('save-btn').addEventListener('click', () => {
            const name = rosterNameEl.value.trim(); const names = studentNamesEl.value.trim();
            if (!name || !names) { alert("Provide a roster name and student list."); return; }
            const rosters = getRosters(); rosters[name] = names; saveRosters(rosters);
            alert(`Roster "${name}" saved!`); loadRosterList();
        });

        document.getElementById('delete-btn').addEventListener('click', () => {
            const selectedName = rosterSelectEl.value;
            if (!selectedName) { alert("Select a roster to delete."); return; }
            if (confirm(`Delete "${selectedName}"?`)) {
                const rosters = getRosters(); delete rosters[selectedName]; saveRosters(rosters);
                alert(`Roster "${selectedName}" deleted.`); rosterNameEl.value = ''; studentNamesEl.value = ''; loadRosterList();
            }
        });

        loadRosterList(); // Initial load of saved rosters
    });


    // ======================= GAMES HUB =======================
    function setupGamesHub() {
        const toolDiv = document.getElementById('games-hub');
        toolDiv.innerHTML = `
            <div class="tool-header"><h2>Games & Activities Hub</h2><button class="back-to-menu-btn" onclick="showView('main-menu')">Back to Menu</button></div>
            <div class="container">
                <div id="dice-roller" class="panel">
                    <h3>Dice Roller</h3>
                    <div id="dice-display">...</div>
                    <label>Number of dice:</label>
                    <select id="dice-count"><option value="1">1</option><option value="2">2</option></select>
                    <button id="roll-dice-btn" style="background-color: var(--success-color); margin-top: 15px;">Roll Dice</button>
                </div>
                <div id="spinner" class="panel">
                    <h3>Classroom Spinner</h3>
                    <label>Enter options (one per line):</label>
                    <textarea id="spinner-options" rows="5">Yes\nNo\nMaybe\nAsk Again</textarea>
                    <div id="spinner-container">
                        <div id="spinner-arrow"></div>
                        <canvas id="spinner-canvas" width="350" height="350"></canvas>
                    </div>
                    <button id="spin-btn" style="background-color: var(--success-color);">Spin!</button>
                    <h3 id="spinner-result"></h3>
                </div>
            </div>`;

        // --- Dice Roller Logic with Animation ---
        const diceDisplay = document.getElementById('dice-display');
        const rollBtn = document.getElementById('roll-dice-btn');
        const diceEmojis = ['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'];
        let isRolling = false;
        rollBtn.addEventListener('click', () => {
            if (isRolling) return;
            isRolling = true; rollBtn.disabled = true;
            let rollInterval = setInterval(() => {
                const count = document.getElementById('dice-count').value;
                let randomResult = '';
                for (let i = 0; i < count; i++) { randomResult += diceEmojis[Math.floor(Math.random() * 6)] + ' '; }
                diceDisplay.textContent = randomResult;
            }, 80);

            setTimeout(() => {
                clearInterval(rollInterval);
                const count = document.getElementById('dice-count').value;
                let finalResult = '';
                for (let i = 0; i < count; i++) { finalResult += diceEmojis[Math.floor(Math.random() * 6)] + ' '; }
                diceDisplay.textContent = finalResult;
                isRolling = false; rollBtn.disabled = false;
            }, 1500);
        });

        // --- Spinner Logic with Arrow ---
        const canvas = document.getElementById('spinner-canvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spin-btn');
        const spinnerResult = document.getElementById('spinner-result');
        const colors = ["#e74c3c", "#f1c40f", "#3498db", "#2ecc71", "#9b59b6", "#e67e22", "#1abc9c", "#34495e"];
        let currentRotation = 0;
        
        const drawSpinner = () => {
            const options = document.getElementById('spinner-options').value.trim().split('\n').filter(opt => opt);
            if (options.length === 0) return;
            const arcSize = 2 * Math.PI / options.length;
            const centerX = canvas.width / 2, centerY = canvas.height / 2;
            ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.strokeStyle = '#fff'; ctx.lineWidth = 2;
            for (let i = 0; i < options.length; i++) {
                const angle = i * arcSize;
                ctx.beginPath(); ctx.fillStyle = colors[i % colors.length];
                ctx.moveTo(centerX, centerY); ctx.arc(centerX, centerY, centerX - 5, angle, angle + arcSize);
                ctx.closePath(); ctx.fill(); ctx.stroke();
                ctx.save();
                ctx.fillStyle = "white"; ctx.font = 'bold 16px sans-serif';
                ctx.translate(centerX + Math.cos(angle + arcSize / 2) * (centerX-60), centerY + Math.sin(angle + arcSize / 2) * (centerY-60));
                ctx.rotate(angle + arcSize / 2 + Math.PI / 2);
                const text = options[i];
                ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
                ctx.restore();
            }
        };
        
        spinBtn.addEventListener('click', () => {
            spinnerResult.textContent = '...';
            const spinAngle = Math.random() * 10 + 10;
            currentRotation += spinAngle * 360;
            canvas.style.transform = `rotate(${currentRotation}deg)`;
            spinBtn.disabled = true;

            setTimeout(() => {
                const options = document.getElementById('spinner-options').value.trim().split('\n').filter(opt => opt);
                const degrees = currentRotation % 360;
                const arcSizeDegrees = 360 / options.length;
                const winningIndex = Math.floor((360 - degrees + 270) % 360 / arcSizeDegrees);
                spinnerResult.textContent = `Result: ${options[winningIndex]}`;
                spinBtn.disabled = false;
            }, 4100);
        });
        document.getElementById('spinner-options').addEventListener('input', drawSpinner);
        drawSpinner();
    }
    
    // --- All other setup functions (Pasted from previous versions) ---
    let timerInterval = null; let timeRemaining = 0;
    function setupTimer() {
        const toolDiv = document.getElementById('timer-tool');
        toolDiv.innerHTML = `<div class="tool-header"><h2>Classroom Timer</h2><button class="back-to-menu-btn" onclick="showView('main-menu')">Back to Menu</button></div><div class="container panel"><div class="encouraging-banner">Focus on the task and do your best work! You've got this! ✨</div><div id="timer-display">00:00</div><div class="timer-inputs"><div><label for="minutes-input">Minutes</label><select id="minutes-input"></select></div><div><label for="seconds-input">Seconds</label><select id="seconds-input"></select></div></div><div class="timer-controls"><button id="start-pause-btn" style="background-color: var(--success-color);">Start</button><button id="reset-btn" style="background-color: var(--warning-color);">Reset</button></div></div>`;
        const minutesSelect = document.getElementById('minutes-input'); const secondsSelect = document.getElementById('seconds-input');
        for (let i = 0; i <= 90; i++) minutesSelect.innerHTML += `<option value="${i}">${i}</option>`;
        for (let i = 0; i < 60; i++) secondsSelect.innerHTML += `<option value="${i}">${String(i).padStart(2, '0')}</option>`;
        const timeDisplay = document.getElementById('timer-display'); const startPauseBtn = document.getElementById('start-pause-btn'); const resetBtn = document.getElementById('reset-btn');
        const timesUpSound = new Audio('data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU2LjQwLjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAABPSUNZAAAAAABoWVdOZwAAACMAAAAeAAAAAABaTEVOQwAAABMAAAASAAAAAEVYVFMAAAAUAAAAEAAAAAAAAAAAAAAAABJNFkAAAAsAAARTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//tAwA8B4Ah4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8AAABpYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY-larkaa');
        function updateDisplay() { if (timeRemaining < 0) return; const minutes = Math.floor(timeRemaining / 60); const seconds = timeRemaining % 60; timeDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`; }
        startPauseBtn.addEventListener('click', () => {
            if (timerInterval) { clearInterval(timerInterval); timerInterval = null; startPauseBtn.textContent = 'Resume'; startPauseBtn.style.backgroundColor = 'var(--primary-color)';
            } else {
                if (timeRemaining <= 0) { const mins = parseInt(minutesSelect.value); const secs = parseInt(secondsSelect.value); timeRemaining = (mins * 60) + secs; }
                if (timeRemaining > 0) {
                    startPauseBtn.textContent = 'Pause'; startPauseBtn.style.backgroundColor = 'var(--warning-color)';
                    timerInterval = setInterval(() => {
                        timeRemaining--; updateDisplay();
                        if (timeRemaining <= 0) { clearInterval(timerInterval); timerInterval = null; timesUpSound.play(); alert("Time's up!"); startPauseBtn.textContent = 'Start'; startPauseBtn.style.backgroundColor = 'var(--success-color)'; }
                    }, 1000);
                }
            }
        });
        resetBtn.addEventListener('click', () => {
            clearInterval(timerInterval); timerInterval = null; const mins = parseInt(minutesSelect.value); const secs = parseInt(secondsSelect.value);
            timeRemaining = (mins * 60) + secs; updateDisplay(); startPauseBtn.textContent = 'Start'; startPauseBtn.style.backgroundColor = 'var(--success-color)';
        });
        minutesSelect.addEventListener('change', () => resetBtn.click()); secondsSelect.addEventListener('change', () => resetBtn.click()); resetBtn.click();
    }
    function setupNotes() {
        const toolDiv = document.getElementById('notes-tool');
        toolDiv.innerHTML = `<div class="tool-header"><h2>Classroom Notes</h2><button class="back-to-menu-btn" onclick="showView('main-menu')">Back to Menu</button></div><div class="container panel"><textarea id="notes-textarea" placeholder="Type your notes here... they will be saved automatically."></textarea><p id="save-status"></p></div>`;
        const notesTextarea = document.getElementById('notes-textarea'); const saveStatus = document.getElementById('save-status'); let saveTimeout;
        notesTextarea.value = localStorage.getItem('teacherToolkitNotes') || '';
        notesTextarea.addEventListener('input', () => {
            localStorage.setItem('teacherToolkitNotes', notesTextarea.value); saveStatus.textContent = 'Saved!'; saveStatus.style.opacity = '1';
            clearTimeout(saveTimeout); saveTimeout = setTimeout(() => { saveStatus.style.opacity = '0'; }, 1500);
        });
    }
    function setupGroupRandomizer() {
        const toolDiv = document.getElementById('group-randomizer-tool');
        toolDiv.innerHTML = `<div class="tool-header"><h2>Group Randomizer</h2><button class="back-to-menu-btn" onclick="showView('main-menu')">Back to Menu</button></div><div class="container panel"><div id="gr-controls" style="display: flex; gap: 20px; margin-bottom: 20px;"><div><label>Number of Groups:</label><input type="number" id="gr-numGroups" min="1"></div><div><label>Max Students per Group:</label><input type="number" id="gr-maxStudents" min="1"></div><button id="gr-generate-btn" style="background-color: #16a085; align-self: flex-end;">Generate Groups</button></div><div id="gr-results"></div></div>`;
        document.getElementById('gr-generate-btn').addEventListener('click', () => {
            const numGroups = document.getElementById('gr-numGroups').value; const maxStudents = document.getElementById('gr-maxStudents').value;
            const resultsDiv = document.getElementById('gr-results'); let students = [...currentStudents];
            for (let i = students.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [students[i], students[j]] = [students[j], students[i]]; }
            let groups = [];
            if (numGroups) { for (let i = 0; i < numGroups; i++) groups.push([]); students.forEach((s, i) => groups[i % numGroups].push(s));
            } else if (maxStudents) { for (let i = 0; i < students.length; i += Number(maxStudents)) { groups.push(students.slice(i, i + Number(maxStudents))); }
            } else { alert("Please enter either number of groups or max students."); return; }
            resultsDiv.innerHTML = '';
            groups.forEach((group, i) => {
                if (group.length === 0) return;
                const card = document.createElement('div'); card.className = 'group-card';
                card.innerHTML = `<h3>Group ${i + 1}</h3><ul>${group.map(s => `<li>${s}</li>`).join('')}</ul>`;
                resultsDiv.appendChild(card);
            });
        });
    }
    function setupSeatingChart() {
        const toolDiv = document.getElementById('seating-chart-tool');
        toolDiv.innerHTML = `<div class="tool-header"><h2>Seating Chart</h2><button class="back-to-menu-btn" onclick="showView('main-menu')">Back to Menu</button></div><div class="container panel"><div id="sc-seating-chart"></div><div id="sc-unassigned" style="display:none; margin-top:15px;"><h3>Unassigned Students:</h3><ul id="sc-unassigned-list"></ul></div></div>`;
        const chartEl = document.getElementById('sc-seating-chart'); const totalSeats = 25;
        let students = [...currentStudents];
        for (let i = students.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [students[i], students[j]] = [students[j], students[i]]; }
        chartEl.innerHTML = ''; for (let i = 1; i <= totalSeats; i++) { chartEl.innerHTML += `<div class="seat" id="seat-${i}"><span class="seat-number">${i}</span><span class="student-name"></span></div>`; }
        const unassignedContainer = document.getElementById('sc-unassigned'); const unassignedList = document.getElementById('sc-unassigned-list');
        students.forEach((student, i) => {
            if (i < totalSeats) {
                const seatEl = document.getElementById(`seat-${i + 1}`);
                setTimeout(() => { seatEl.querySelector('.student-name').textContent = student; seatEl.classList.add('occupied'); }, i * 60);
            } else { unassignedContainer.style.display = 'block'; unassignedList.innerHTML += `<li>${student}</li>`; }
        });
    }
    let sp_availableStudents = []; let sp_isSpinning = false;
    function setupStudentPicker() {
        const toolDiv = document.getElementById('student-picker-tool');
        toolDiv.innerHTML = `<div class="tool-header"><h2>Student Picker</h2><button class="back-to-menu-btn" onclick="showView('main-menu')">Back to Menu</button></div><div class="container"><div class="panel controls-panel"><h3>Controls</h3><button id="sp-pick-btn" style="background-color: #16a085; padding: 15px; font-size: 1.2em;">Pick a Student!</button><div style="margin-top: 20px; display: flex; align-items:center; gap: 5px;"><input type="checkbox" id="sp-no-repeat" style="width: auto;"><label for="sp-no-repeat"> Don't pick same student twice</label></div><button id="sp-reset-btn" style="background-color: var(--warning-color); margin-top: 10px;">Reset Available Students</button></div><div class="panel picker-panel"><h2>The chosen student is...</h2><div id="sp-picker-display"><h2 id="sp-student-name-display">?</h2></div></div></div>`;
        const nameDisplayEl = document.getElementById('sp-student-name-display'); const noRepeatCheckbox = document.getElementById('sp-no-repeat');
        const resetAvailable = (showAlert = true) => {
            sp_availableStudents = [...currentStudents];
            if(showAlert) alert(`Picker reset. ${sp_availableStudents.length} students are now available.`);
        };
        resetAvailable(false);
        document.getElementById('sp-reset-btn').addEventListener('click', () => resetAvailable());
        document.getElementById('sp-pick-btn').addEventListener('click', () => {
            if (sp_isSpinning) return;
            let studentPool = noRepeatCheckbox.checked ? sp_availableStudents : currentStudents;
            if (noRepeatCheckbox.checked && studentPool.length === 0) { alert("All students have been picked! Resetting."); resetAvailable(false); studentPool = sp_availableStudents; }
            if (studentPool.length === 0) { alert("There are no students to pick from."); return; }
            sp_isSpinning = true;
            const interval = setInterval(() => { nameDisplayEl.textContent = studentPool[Math.floor(Math.random() * studentPool.length)]; }, 75);
            setTimeout(() => {
                clearInterval(interval);
                const chosen = studentPool[Math.floor(Math.random() * studentPool.length)];
                nameDisplayEl.textContent = chosen;
                if (noRepeatCheckbox.checked) { sp_availableStudents = sp_availableStudents.filter(s => s !== chosen); }
                sp_isSpinning = false;
            }, 2500);
        });
    }
        
    // --- Initialize the app ---
    document.addEventListener('DOMContentLoaded', () => {
        loadRosterList();
    });
    </script>
</body>
</html>